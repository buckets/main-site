Internal refactorings to get ready for mobile app
