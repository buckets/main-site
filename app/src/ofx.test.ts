import { test } from 'tap'
import { ofx2importable } from './ofx'


test('sample1', async t => {
  let data = `OFXHEADER:100
DATA:OFXSGML
VERSION:102
SECURITY:NONE
ENCODING:USASCII
CHARSET:1252
COMPRESSION:NONE
OLDFILEUID:NONE
NEWFILEUID:NONE

<OFX>
<SIGNONMSGSRSV1>
<SONRS>
<STATUS>
<CODE>0
<SEVERITY>INFO
</STATUS>
<DTSERVER>20121004210819
<LANGUAGE>ENG
</SONRS>
</SIGNONMSGSRSV1>
<BANKMSGSRSV1>
<STMTTRNRS>
<TRNUID>1349428292
<STATUS>
<CODE>0
<SEVERITY>INFO
</STATUS>
<STMTRS>
<CURDEF>NZD
<BANKACCTFROM>
<BANKID>01
<BRANCHID>0123
<ACCTID>1234567-00
<ACCTTYPE>SAVINGS
</BANKACCTFROM>
<BANKTRANLIST>
<DTSTART>20120101
<DTEND>20121003
<STMTTRN>
<TRNTYPE>INT
<DTPOSTED>20120928
<TRNAMT>19.90
<FITID>20120928.0
<MEMO>Credit Interest Paid
</STMTTRN>
<STMTTRN>
<TRNTYPE>DEBIT
<DTPOSTED>20120928
<TRNAMT>-1.01
<FITID>20120928.1
<MEMO>Withholding Tax
</STMTTRN>
<STMTTRN>
<TRNTYPE>DEBIT
<DTPOSTED>20120907
<TRNAMT>-100.00
<FITID>20120907.0
<NAME>06 0773 0214764 33
<MEMO>Debit Transfer: Bike
</STMTTRN>
<STMTTRN>
<TRNTYPE>DEBIT
<DTPOSTED>20120907
<TRNAMT>-71.99
<FITID>201209071
<NAME>Transfer
<MEMO>Debit Transfer: Postage
</STMTTRN>
<STMTTRN>
<TRNTYPE>DEBIT
<DTPOSTED>20120104
<TRNAMT>-20.01
<FITID>20120104.6
<NAME>Transfer
<MEMO>Debit Transfer Party
</STMTTRN>
</BANKTRANLIST>
<LEDGERBAL>
<BALAMT>4225.79
<DTASOF>20121004
</LEDGERBAL>
<AVAILBAL>
<BALAMT>12.79
<DTASOF>20121004
</AVAILBAL>
</STMTRS>
</STMTTRNRS>
</BANKMSGSRSV1>
</OFX>`
  let transactions = await ofx2importable(data);
  t.equal(transactions.length, 5, "Should have 5 transactions");
})

test('sample2', async t => {
  let data = `OFXHEADER:100
DATA:OFXSGML
VERSION:102
SECURITY:NONE
ENCODING:USASCII
CHARSET:1252
COMPRESSION:NONE
OLDFILEUID:NONE
NEWFILEUID:NONE

<OFX>
  <SIGNONMSGSRSV1>
    <SONRS>
      <STATUS>
        <CODE>0
        <SEVERITY>INFO
      </STATUS>
      <DTSERVER>20160509013234.900
      <LANGUAGE>ENG
      <DTPROFUP>20050531060000.000
      <FI>
        <ORG>GOOBYGOO
        <FID>1001
      </FI>
      <INTU.BID>99999
      <INTU.USERID>12345
    </SONRS>
  </SIGNONMSGSRSV1>
  <BANKMSGSRSV1>
    <STMTTRNRS>
      <TRNUID>0
      <STATUS>
        <CODE>0
        <SEVERITY>INFO
      </STATUS>
      <STMTRS>
        <CURDEF>USD
        <BANKACCTFROM>
          <BANKID>1111111111
          <ACCTID>55555555~1
          <ACCTTYPE>SAVINGS
        </BANKACCTFROM>
        <BANKTRANLIST>
          <DTSTART>20160429060000.000
          <DTEND>20160508060000.000
          <STMTTRN>
            <TRNTYPE>CREDIT
            <DTPOSTED>20160430120000.000
            <TRNAMT>0.17
            <FITID>0000760
            <NAME>DIVIDEND EARNED FOR PERIOD OF 04
            <MEMO>DIVIDEND EARNED FOR PERIOD OF 04/01/2016 THROUGH 04/30/2016 ANNUAL PERCENTAGE YIELD EARNED IS 0.10%
          </STMTTRN>
        </BANKTRANLIST>
        <LEDGERBAL>
          <BALAMT>2068.04
          <DTASOF>20160509013234.900
        </LEDGERBAL>
        <AVAILBAL>
          <BALAMT>2067.04
          <DTASOF>20160509013234.900
        </AVAILBAL>
      </STMTRS>
    </STMTTRNRS>
  </BANKMSGSRSV1>
</OFX>`
  let transactions = await ofx2importable(data);
  t.equal(transactions.length, 1)
})