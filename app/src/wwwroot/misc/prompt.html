<!DOCTYPE html>
<html>
<head>
  <title data-translate data-comment="Title for prompt window">Prompt</title>
  <link rel="stylesheet" type="text/css" href="../assets/fonts.css" />
  <link rel="stylesheet" type="text/css" href="../assets/style.css" />
  <link rel="stylesheet" type="text/css" href="../assets/singlepane.css" />
  <style type="text/css">
    #prompt {

    }
    #error {
      color: var(--red);
    }
    #input {
      margin-top: .5rem;
    }
    .buttons {
      padding: .5rem 0;
    }
    .buttons button:first-child {
      margin-left: 0;
    }
  </style>
  <style type="text/css">
  </style>
</head>
<body class="singlepane">
  <div class="singlepane-handle"></div>
  <div class="singlepane-guts">
    <form id="theform">
      <div id="prompt"></div>
      <div id="error"></div>
      <div>
        <input id="input" type="text" autofocus>
      </div>
      <div class="buttons">
        <a href="#" id="cancel">Cancel</a>
        <button class="primary" type="submit">OK</button>
      </div>
    </form>
  </div>
<script>
const {remote} = require('electron');
const Path = require('path');
const appPath = remote.app.getAppPath();
const req = function() {
  return (module) => {
    if (module.startsWith('.') || module.startsWith('/')) {
      return require(Path.resolve(appPath, module))
    } else {
      return require(module);
    }
  }
}();

req('./src/wwwroot/misc/singlepane.js');

const { localizeThisPage } = req('./src/i18n');
const { ipcRenderer } = req('electron');
const querystring = req('querystring');

localizeThisPage();

let qs = querystring.parse(window.location.search.substr(1));

let prompt = document.getElementById('prompt');
let error = document.getElementById('error');
let theform = document.getElementById('theform');
let cancel = document.getElementById('cancel');
let input = document.getElementById('input');
if (qs.hideinput) {
  input.setAttribute('type', 'password');
}
if (qs.error) {
  error.innerHTML = qs.error;
}
prompt.innerHTML = qs.prompt;

theform.addEventListener('submit', (ev) => {
  ipcRenderer.send(qs.key, {response: input.value});
  ev.preventDefault();
}, false)

cancel.addEventListener('click', (ev) => {
  ipcRenderer.send(qs.key, {error:'canceled'});
  ev.preventDefault();
}, false);
</script>
</body>
</html>