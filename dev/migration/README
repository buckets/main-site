
# How to migrate data from old pb database to new one

1. Set up connection.

For dev:
    
    export DATABASE_URL="postgres://postgres:postgres@192.168.99.100:5432/postgres"

For openshift, see below.



2. Get the live dump:

    rhc ssh pybuckets --command 'echo working'
    ./getdump.sh

3. Put it into the database

    ./putdump.sh $DATABASE_URL

4. Optionally wipe existing data

    ./wipe.sh $DATABASE_URL

5. Copy from old schema to new schema

    ./convert.sh $DATABASE_URL

(You can repeat steps 4 and 5 to test out convert.sh)

# openshift

For the live one:

    PGHOST=$(rhc ssh --command 'echo $OPENSHIFT_POSTGRESQL_DB_HOST')
    PGUSER=$(rhc ssh --command 'echo $OPENSHIFT_POSTGRESQL_DB_USERNAME')
    PGPASS=$(rhc ssh --command 'echo $OPENSHIFT_POSTGRESQL_DB_PASSWORD')

Then start forwarding:

    rhc ssh --ssh "ssh -L 5432:${PGHOST}:5432"

Then set the db url:
    
    export DATABASE_URL="postgresql://${PGUSER}:${PGPASS}@127.0.0.1:5432/buckets"
